{% extends 'base.html' %}
{% from 'base.html' import flash_errors %}

{% block title %}Schedule Planner{% endblock %}

{% block content %}
  <div class="card shadow-sm">
    <div class="card-body p-4">
      <h2 class="h4 mb-3">Create your schedule</h2>
      <form method="post" novalidate>
        <div id="tasks" class="vstack gap-2">
          {% for r in form_rows %}
          <div class="d-flex gap-2 align-items-center task-row">
            <input type="text" name="tasks[]" class="form-control" placeholder="Task name" value="{{ r.task }}">
            <input type="number" name="percentages[]" class="form-control pct" min="0" max="100" step="0.01" placeholder="%" value="{{ r.pct }}">
            <button class="btn btn-outline-secondary" type="button" onclick="removeRow(this)">Remove</button>
          </div>
          {% endfor %}
        </div>
        <div class="d-flex gap-2 mt-2">
          <button class="btn btn-primary" type="button" onclick="addRow()">Add task</button>
        </div>
        <div class="row g-3 mt-2">
          <div class="col-6">
            <label class="form-label">Available days</label>
            <input type="number" name="available_days" class="form-control" min="1" value="{{ defaults.available_days }}">
          </div>
          <div class="col-6">
            <label class="form-label">Hours per day</label>
            <input type="number" name="hours_per_day" class="form-control" min="1" value="{{ defaults.hours_per_day }}">
          </div>
        </div>
        {{ flash_errors(errors) }}
        <div class="mt-3">
          <button class="btn btn-success" type="submit">Compute</button>
        </div>
      </form>

      {% if result %}
        <hr class="my-4">
        <h3 class="h5 mb-3">Results</h3>
        <div class="table-responsive">
          <table class="table table-bordered align-middle">
            <thead>
              <tr>
                <th>Task</th>
                {% for d in result.days %}
                  <th>Day {{ d }}</th>
                {% endfor %}
                <th>Total hours</th>
              </tr>
            </thead>
            <tbody>
              {% for r in result.rows %}
                <tr>
                  <td>{{ r.task }}</td>
                  {% for cell in r.cells %}<td>{{ '%.2f'|format(cell) }}</td>{% endfor %}
                  <td>{{ '%.2f'|format(r.total) }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
